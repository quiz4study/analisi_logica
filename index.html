<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz di Analisi Logica con Feedback Errori</title>
    <style>
        body { font-family: sans-serif; background-color: #f3f4f6; padding: 20px; color: #374151; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1e40af; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 30px; }
        .question-block { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e5e7eb; position: relative; }
        .question-text { font-size: 1.1em; margin-bottom: 15px; font-weight: 500; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .highlight { color: #2563eb; font-weight: bold; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        @media (min-width: 600px) { .options-grid { grid-template-columns: repeat(3, 1fr); } }
        .option-btn { padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s; text-align: left; font-size: 0.95em; }
        .option-btn:hover:not(:disabled) { border-color: #3b82f6; background-color: #eff6ff; }
        .correct { background-color: #d1fae5 !important; border-color: #10b981 !important; color: #065f46; font-weight: bold; }
        .incorrect { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b; }
        .hint-btn { background: #fef3c7; border: 1px solid #f59e0b; color: #92400e; padding: 4px 10px; border-radius: 6px; font-size: 0.8em; cursor: pointer; white-space: nowrap; }
        .hint-text, .error-feedback { display: none; margin-top: 10px; padding: 12px; border-radius: 6px; font-size: 0.9em; line-height: 1.4; }
        .hint-text { background: #fffbeb; border-left: 4px solid #f59e0b; color: #92400e; font-style: italic; }
        .error-feedback { background: #fef2f2; border-left: 4px solid #ef4444; color: #991b1b; }
        .score-box { margin-top: 30px; padding: 20px; background: #eff6ff; border-radius: 8px; text-align: center; border: 1px solid #bfdbfe; }
        .score-num { font-size: 2em; font-weight: bold; color: #2563eb; }
        .restart-btn { margin-top: 15px; padding: 10px 25px; background: #2563eb; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .repeat-msg { color: #b91c1c; font-weight: bold; margin-top: 10px; display: none; padding: 10px; border: 1px dashed #f87171; border-radius: 8px; background: #fff5f5; }
        .repeat-btn-active { display: none; margin-top: 10px; padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Esercitazione di Analisi Logica</h1>
        <p class="subtitle">Le posizioni delle risposte sono ora rimescolate domanda per domanda.</p>

        <div id="quiz-content"></div>

        <div class="score-box">
            <div>Il tuo Punteggio</div>
            <div id="score-display" class="score-num">0 / 25</div>
            
            <div id="repeat-feedback" class="repeat-msg">
                Il tuo punteggio √® inferiore a 15/25. Ti consigliamo di ripetere l'esercitazione per fissare meglio i concetti.
            </div>
            
            <button id="main-restart" onclick="window.location.reload()" class="restart-btn">Ricomincia da capo</button>
            <br>
            <button id="repeat-btn" onclick="window.location.reload()" class="repeat-btn-active">Ripeti l'esercitazione</button>
        </div>
    </div>

    <script>
        const rawQuestions = [
            { q: "Ascolto **la musica** in cuffia.", options: ["Comp. oggetto", "Comp. di specificazione", "Comp. di termine"], correct: "Comp. oggetto", hint: "Risponde alla domanda: Chi? Che cosa?", explain: "√à un complemento oggetto perch√© l'azione del verbo 'ascoltare' ricade direttamente su 'la musica'." },
            { q: "Il cancello **del giardino** √® aperto.", options: ["Comp. di specificazione", "Comp. di denominazione", "Comp. di luogo"], correct: "Comp. di specificazione", hint: "Risponde alla domanda: Di chi? Di che cosa?", explain: "√à specificazione perch√© precisa a cosa appartiene o si riferisce il cancello." },
            { q: "Il comune **di Milano** ha emanato un'ordinanza.", options: ["Comp. di denominazione", "Comp. di specificazione", "Comp. di termine"], correct: "Comp. di denominazione", hint: "D√† un nome proprio a un nome comune.", explain: "√à denominazione perch√© 'Milano' √® il nome proprio che denomina il 'comune'." },
            { q: "Consegna il pacco **al portiere**.", options: ["Comp. di termine", "Comp. oggetto", "Comp. d'agente"], correct: "Comp. di termine", hint: "Risponde alla domanda: A chi?", explain: "√à un complemento di termine perch√© indica la persona a cui √® destinato l'oggetto." },
            { q: "La lettera √® stata scritta **da Paolo**.", options: ["Comp. d'agente", "Comp. di causa", "Comp. di modo"], correct: "Comp. d'agente", hint: "In una frase passiva, chi fa l'azione?", explain: "In una frase passiva, chi compie l'azione √® il complemento d'agente." },
            { q: "I ragazzi giocano **in cortile**.", options: ["Stato in luogo", "Moto a luogo", "Moto per luogo"], correct: "Stato in luogo", hint: "Indica dove si svolge l'azione restando l√¨.", explain: "√à stato in luogo perch√© indica dove si trovano i ragazzi mentre giocano." },
            { q: "Stasera andiamo **in pizzeria**.", options: ["Moto a luogo", "Stato in luogo", "Moto da luogo"], correct: "Moto a luogo", hint: "Indica la meta di un movimento.", explain: "√à moto a luogo perch√© indica la destinazione verso cui ci si muove." },
            { q: "Siamo appena tornati **dalle vacanze**.", options: ["Moto da luogo", "Moto per luogo", "Moto a luogo"], correct: "Moto da luogo", hint: "Indica il luogo da cui si proviene.", explain: "√à moto da luogo perch√© indica la provenienza del movimento." },
            { q: "Siamo passati **attraverso i campi**.", options: ["Moto per luogo", "Stato in luogo", "Moto a luogo"], correct: "Moto per luogo", hint: "Indica un transito o un passaggio.", explain: "√à moto per luogo perch√© indica il luogo che viene attraversato." },
            { q: "La torta sar√† pronta **a mezzogiorno**.", options: ["Tempo determinato", "Tempo continuato", "Comp. di termine"], correct: "Tempo determinato", hint: "Indica un momento preciso nel tempo.", explain: "√à tempo determinato perch√© indica l'ora esatta in cui avverr√† l'azione." },
            { q: "Ha piovuto **per ore**.", options: ["Tempo continuato", "Tempo determinato", "Comp. di causa"], correct: "Tempo continuato", hint: "Indica la durata di un'azione.", explain: "√à tempo continuato perch√© indica per quanto tempo si √® protratta la pioggia." },
            { q: "Taglia il pane **col coltello**.", options: ["Comp. di mezzo", "Comp. di modo", "Comp. di compagnia"], correct: "Comp. di mezzo", hint: "Con quale strumento?", explain: "√à un complemento di mezzo perch√© il coltello √® lo strumento usato per tagliare." },
            { q: "Mi ha parlato **con dolcezza**.", options: ["Comp. di modo", "Comp. di unione", "Comp. di mezzo"], correct: "Comp. di modo", hint: "In che modo?", explain: "√à un complemento di modo perch√© descrive la maniera in cui √® stata fatta l'azione." },
            { q: "Non dormo **per la preoccupazione**.", options: ["Comp. di causa", "Comp. di fine", "Comp. di modo"], correct: "Comp. di causa", hint: "Qual √® il motivo/la causa?", explain: "√à causa perch√© la preoccupazione √® il motivo scatenante del non dormire." },
            { q: "Studiamo **per il successo** del progetto.", options: ["Comp. di fine", "Comp. di causa", "Comp. di termine"], correct: "Comp. di fine", hint: "Qual √® l'obiettivo finale?", explain: "√à un complemento di fine perch√© il successo √® lo scopo che si vuole raggiungere." },
            { q: "Sono andato a fare shopping **con Anna**.", options: ["Comp. di compagnia", "Comp. di unione", "Comp. di modo"], correct: "Comp. di compagnia", hint: "Insieme a chi?", explain: "√à compagnia perch√© si riferisce a un essere animato che accompagna il soggetto." },
            { q: "Mi piace il caff√® **con lo zucchero**.", options: ["Comp. di unione", "Comp. di compagnia", "Comp. di mezzo"], correct: "Comp. di unione", hint: "Insieme a quale cosa?", explain: "√à unione perch√© si riferisce a una cosa inanimata che accompagna un'altra cosa." },
            { q: "Il nonno racconta storie **sulla guerra**.", options: ["Comp. di argomento", "Comp. di specificazione", "Comp. di denominazione"], correct: "Comp. di argomento", hint: "Qual √® il tema del discorso?", explain: "√à argomento perch√© indica il tema o l'oggetto di cui si sta parlando." },
            { q: "Hai perso **le chiavi**?", options: ["Comp. oggetto", "Comp. di termine", "Comp. di specificazione"], correct: "Comp. oggetto", hint: "Cosa hai perso?", explain: "√à complemento oggetto perch√© risponde alla domanda 'che cosa?' dopo il verbo." },
            { q: "La fine **del film** √® stata commovente.", options: ["Comp. di specificazione", "Comp. di denominazione", "Comp. di termine"], correct: "Comp. di specificazione", hint: "Di che cosa?", explain: "√à specificazione perch√© specifica a quale opera si riferisce il termine 'fine'." },
            { q: "Il deserto **del Sahara** √® vastissimo.", options: ["Comp. di denominazione", "Comp. di specificazione", "Stato in luogo"], correct: "Comp. di denominazione", hint: "Nome proprio del deserto.", explain: "√à denominazione perch√© attribuisce il nome proprio a un nome comune geografico." },
            { q: "Ho inviato un messaggio **a Giorgio**.", options: ["Comp. di termine", "Comp. oggetto", "Comp. d'agente"], correct: "Comp. di termine", hint: "A chi √® rivolto?", explain: "√à termine perch√© indica il destinatario finale dell'azione di inviare." },
            { q: "Il guasto √® stato riparato **dal tecnico**.", options: ["Comp. d'agente", "Comp. di termine", "Comp. di causa efficiente"], correct: "Comp. d'agente", hint: "Chi ha riparato?", explain: "In una frase passiva, l'essere animato che agisce √® il complemento d'agente." },
            { q: "Il gatto √® rimasto **sul tetto**.", options: ["Stato in luogo", "Moto per luogo", "Moto a luogo"], correct: "Stato in luogo", hint: "Dove si trova fermo?", explain: "√à stato in luogo perch√© indica la posizione statica del gatto." },
            { q: "Domani voleremo **a Londra**.", options: ["Moto a luogo", "Stato in luogo", "Moto da luogo"], correct: "Moto a luogo", hint: "Destinazione del volo.", explain: "√à moto a luogo perch√© indica la meta finale del movimento." }
        ];

        let score = 0;
        const totalQuestions = rawQuestions.length;
        const answeredQuestions = new Set();

        // Funzione per rimescolare un array in modo sicuro
        function shuffleArray(array) {
            let arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function toggleHint(idx) {
            const h = document.getElementById('hint-' + idx);
            h.style.display = (h.style.display === 'block') ? 'none' : 'block';
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-content');
            container.innerHTML = '';
            
            rawQuestions.forEach((question, index) => {
                // Rimescoliamo le opzioni SPECIFICAMENTE per questa riga
                const currentOptions = shuffleArray(question.options);
                
                const qDiv = document.createElement('div');
                qDiv.className = "question-block";
                qDiv.innerHTML = `
                    <div class="question-text">
                        <span>${index + 1}. ${question.q.replace(/\*\*(.*?)\*\*/g, '<span class="highlight">$1</span>')}</span>
                        <button class="hint-btn" onclick="toggleHint(${index})">Aiuto</button>
                    </div>
                    <div id="hint-${index}" class="hint-text">üí° Suggerimento: ${question.hint}</div>
                    <div id="error-${index}" class="error-feedback">‚ùå Errore. ${question.explain}</div>
                    <div class="options-grid" id="opts-${index}"></div>
                `;
                container.appendChild(qDiv);
                
                const optGrid = document.getElementById('opts-' + index);
                currentOptions.forEach((optText) => {
                    const btn = document.createElement('button');
                    btn.className = "option-btn";
                    btn.innerText = optText;
                    btn.onclick = () => checkAnswer(btn, index, optText, question.correct);
                    optGrid.appendChild(btn);
                });
            });
        }

        function checkAnswer(selectedBtn, qIdx, selectedText, correctText) {
            if (answeredQuestions.has(qIdx)) return;
            answeredQuestions.add(qIdx);
            
            const parent = selectedBtn.parentElement;
            const buttons = parent.getElementsByTagName('button');
            const errorDiv = document.getElementById('error-' + qIdx);
            const hintBtn = selectedBtn.closest('.question-block').querySelector('.hint-btn');

            hintBtn.disabled = true;
            hintBtn.style.opacity = "0.3";

            if (selectedText === correctText) {
                selectedBtn.classList.add('correct');
                score++;
            } else {
                selectedBtn.classList.add('incorrect');
                for (let btn of buttons) {
                    if (btn.innerText === correctText) {
                        btn.classList.add('correct');
                    }
                }
                errorDiv.style.display = 'block';
            }
            
            document.getElementById('score-display').innerText = score + " / " + totalQuestions;

            if (answeredQuestions.size === totalQuestions) {
                showFinalFeedback();
            }
        }

        function showFinalFeedback() {
            const repeatMsg = document.getElementById('repeat-feedback');
            const repeatBtn = document.getElementById('repeat-btn');
            const mainRestart = document.getElementById('main-restart');

            if (score < 15) {
                repeatMsg.style.display = 'block';
                repeatBtn.style.display = 'inline-block';
                mainRestart.style.display = 'none';
            }
        }

        window.onload = renderQuiz;
    </script>
</body>
</html>
